<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=https://nship.dev/ rel=canonical><link rel=icon href=favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.6.9"><title>NShip</title><link rel=stylesheet href=assets/stylesheets/main.4af4bdda.min.css><link rel=stylesheet href=assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#nship class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class="md-header md-header--shadow" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=. title=NShip class="md-header__button md-logo" aria-label=NShip data-md-component=logo> <img src=logo256.png alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> NShip </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> NShip </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=slate data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> <input class=md-option data-md-color-media data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/nickalie/nship title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--integrated" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=. title=NShip class="md-nav__button md-logo" aria-label=NShip data-md-component=logo> <img src=logo256.png alt=logo> </a> NShip </label> <div class=md-nav__source> <a href=https://github.com/nickalie/nship title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> NShip </span> <span class="md-nav__icon md-icon"></span> </label> <a href=. class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> NShip </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#features class=md-nav__link> <span class=md-ellipsis> Features </span> </a> </li> <li class=md-nav__item> <a href=#getting-started class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> <nav class=md-nav aria-label="Getting Started"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#installation class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> <nav class=md-nav aria-label=Installation> <ul class=md-nav__list> <li class=md-nav__item> <a href=#binary-releases class=md-nav__link> <span class=md-ellipsis> Binary Releases </span> </a> </li> <li class=md-nav__item> <a href=#linux-package-managers class=md-nav__link> <span class=md-ellipsis> Linux Package Managers </span> </a> </li> <li class=md-nav__item> <a href=#go-install class=md-nav__link> <span class=md-ellipsis> Go Install </span> </a> </li> <li class=md-nav__item> <a href=#build-from-source class=md-nav__link> <span class=md-ellipsis> Build from Source </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#usage class=md-nav__link> <span class=md-ellipsis> Usage </span> </a> <nav class=md-nav aria-label=Usage> <ul class=md-nav__list> <li class=md-nav__item> <a href=#environment-files class=md-nav__link> <span class=md-ellipsis> Environment Files </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#configuration class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> <nav class=md-nav aria-label=Configuration> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuration-formats class=md-nav__link> <span class=md-ellipsis> Configuration Formats </span> </a> </li> <li class=md-nav__item> <a href=#dynamic-configuration-with-programming-languages class=md-nav__link> <span class=md-ellipsis> Dynamic Configuration with Programming Languages </span> </a> <nav class=md-nav aria-label="Dynamic Configuration with Programming Languages"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#typescriptjavascript-benefits class=md-nav__link> <span class=md-ellipsis> TypeScript/JavaScript Benefits </span> </a> </li> <li class=md-nav__item> <a href=#golang-configuration-benefits class=md-nav__link> <span class=md-ellipsis> Golang Configuration Benefits </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#command-based-configuration class=md-nav__link> <span class=md-ellipsis> Command-based Configuration </span> </a> </li> <li class=md-nav__item> <a href=#example-configurations class=md-nav__link> <span class=md-ellipsis> Example Configurations </span> </a> <nav class=md-nav aria-label="Example Configurations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#yaml-configuration class=md-nav__link> <span class=md-ellipsis> YAML Configuration </span> </a> </li> <li class=md-nav__item> <a href=#json-configuration class=md-nav__link> <span class=md-ellipsis> JSON Configuration </span> </a> </li> <li class=md-nav__item> <a href=#typescript-configuration class=md-nav__link> <span class=md-ellipsis> TypeScript Configuration </span> </a> </li> <li class=md-nav__item> <a href=#typescript-with-dynamic-configuration class=md-nav__link> <span class=md-ellipsis> TypeScript with Dynamic Configuration </span> </a> </li> <li class=md-nav__item> <a href=#golang-configuration class=md-nav__link> <span class=md-ellipsis> Golang Configuration </span> </a> </li> <li class=md-nav__item> <a href=#example-configuration-toml class=md-nav__link> <span class=md-ellipsis> Example Configuration (TOML) </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#deployment-steps class=md-nav__link> <span class=md-ellipsis> Deployment Steps </span> </a> <nav class=md-nav aria-label="Deployment Steps"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#run-step class=md-nav__link> <span class=md-ellipsis> Run Step </span> </a> </li> <li class=md-nav__item> <a href=#copy-step class=md-nav__link> <span class=md-ellipsis> Copy Step </span> </a> </li> <li class=md-nav__item> <a href=#docker-step class=md-nav__link> <span class=md-ellipsis> Docker Step </span> </a> <nav class=md-nav aria-label="Docker Step"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#supported-keys-in-docker-step class=md-nav__link> <span class=md-ellipsis> Supported Keys in Docker Step </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#ansible-vault-support class=md-nav__link> <span class=md-ellipsis> Ansible Vault Support </span> </a> </li> <li class=md-nav__item> <a href=#skipping-unchanged-steps class=md-nav__link> <span class=md-ellipsis> Skipping Unchanged Steps </span> </a> </li> <li class=md-nav__item> <a href=#contributing class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=#license class=md-nav__link> <span class=md-ellipsis> License </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=nship>NShip</h1> <p>nship is a flexible and efficient deployment automation tool designed to streamline the execution of deployment jobs across multiple targets. It simplifies the configuration and execution of deployment workflows by providing structured job and target management.</p> <h2 id=features>Features</h2> <ul> <li>Define deployment jobs with structured steps.</li> <li>Support for remote deployment targets with SSH authentication.</li> <li>Configuration management using YAML, JSON, TOML, TypeScript, JavaScript, Golang, or any command output.</li> <li>Built-in support for file copying, script execution, and Docker container management.</li> <li>Ansible Vault decryption support for handling secure credentials.</li> <li>Skipping unchanged steps for optimized execution.</li> <li>CLI-based execution with customizable environment loading.</li> </ul> <h2 id=getting-started>Getting Started</h2> <h3 id=installation>Installation</h3> <p>You can install nship in several ways:</p> <h4 id=binary-releases>Binary Releases</h4> <p>Download pre-built binaries for your platform from the <a href=https://github.com/nickalie/nship/releases>GitHub Releases page</a>.</p> <p>We provide binaries for:</p> <ul> <li> <p>Linux (x86_64, arm64)</p> </li> <li> <p>macOS (x86_64, arm64)</p> </li> <li> <p>Windows (x86_64, arm64)</p> </li> </ul> <h4 id=linux-package-managers>Linux Package Managers</h4> <p>For Debian/Ubuntu:</p> <pre><code class=language-sh>curl -LO https://github.com/nickalie/nship/releases/download/v{version}/nship_{version}_linux_x86_64.deb
sudo dpkg -i nship_{version}_linux_x86_64.deb
</code></pre> <p>For RHEL/CentOS/Fedora:</p> <pre><code class=language-sh>curl -LO https://github.com/nickalie/nship/releases/download/v{version}/nship_{version}_linux_x86_64.rpm
sudo rpm -i nship_{version}_linux_x86_64.rpm
</code></pre> <p>For Alpine Linux:</p> <pre><code class=language-sh>curl -LO https://github.com/nickalie/nship/releases/download/v{version}/nship_{version}_linux_x86_64.apk
sudo apk add --allow-untrusted nship_{version}_linux_x86_64.apk
</code></pre> <h4 id=go-install>Go Install</h4> <p>If you have Go installed:</p> <pre><code class=language-sh>go install github.com/nickalie/nship/cmd/nship@latest
</code></pre> <h4 id=build-from-source>Build from Source</h4> <p>To build nship from source:</p> <pre><code class=language-sh># Clone the repository
git clone https://github.com/nickalie/nship.git
cd nship

# Build the application
make build
</code></pre> <h3 id=usage>Usage</h3> <p>Run a deployment job using:</p> <pre><code class=language-sh>nship --config=config.yaml --job=deploy-app
</code></pre> <p>Additional options:</p> <ul> <li><code>--config=&lt;path&gt;</code>: Path to the configuration file (default: <code>nship.yaml</code>).</li> <li><code>--job=&lt;name&gt;</code>: Name of the job to run.</li> <li><code>--env-file=&lt;path&gt;</code>: Path to an environment file (can be specified multiple times).</li> <li><code>--vault-password=&lt;password&gt;</code>: Password for decrypting Ansible Vault files.</li> <li><code>--no-skip</code>: Disable skipping unchanged steps.</li> <li><code>--version</code>: Show version information.</li> </ul> <h4 id=environment-files>Environment Files</h4> <p>Environment files can be specified in several ways:</p> <pre><code class=language-sh># Single environment file
nship --env-file=dev.env

# Multiple environment files using multiple flags
nship --env-file=dev.env --env-file=secrets.env
</code></pre> <h2 id=configuration>Configuration</h2> <p>nship offers exceptional flexibility in how you define your deployment configurations. Choose the format that best fits your workflow:</p> <h3 id=configuration-formats>Configuration Formats</h3> <ul> <li><strong>YAML/JSON/TOML</strong>: Simple, structured formats for static configurations</li> <li><strong>TypeScript/JavaScript</strong>: Leverage the full power of a programming language with type safety, variables, and logic</li> <li><strong>Golang</strong>: Use Go's strong typing and performance for complex configuration needs</li> <li><strong>Command Output</strong>: Generate configurations dynamically using any script or command</li> </ul> <h3 id=dynamic-configuration-with-programming-languages>Dynamic Configuration with Programming Languages</h3> <h4 id=typescriptjavascript-benefits>TypeScript/JavaScript Benefits</h4> <ul> <li><strong>Type Safety</strong>: Catch configuration errors before runtime with TypeScript</li> <li><strong>Code Reuse</strong>: Create functions for repeated configuration patterns</li> <li><strong>Environment Handling</strong>: Programmatically include environment-specific settings</li> <li><strong>Dynamic Generation</strong>: Generate configurations based on external data sources</li> </ul> <h4 id=golang-configuration-benefits>Golang Configuration Benefits</h4> <ul> <li><strong>Strong Typing</strong>: Ensure configuration correctness with Go's type system</li> <li><strong>Builder Pattern</strong>: Use the builder API for cleaner configuration construction</li> <li><strong>Performance</strong>: Generate complex configurations efficiently</li> <li><strong>Direct Integration</strong>: Access Go libraries within your configuration</li> </ul> <h3 id=command-based-configuration>Command-based Configuration</h3> <p>Command-based configurations provide maximum flexibility by letting you generate configurations dynamically:</p> <pre><code class=language-sh># Use output from any command as configuration
nship --config=&quot;cmd:curl https://example.com/config&quot;

# Generate environment-specific configurations
nship --config=&quot;cmd:./generate-config.sh --env=production&quot;

# Use database-driven configurations
nship --config=&quot;cmd:python scripts/db_to_config.py&quot;
</code></pre> <p>This approach enables: - <strong>CI/CD Integration</strong>: Generate configurations during pipeline execution - <strong>Centralized Management</strong>: Pull configurations from central repositories - <strong>Dynamic Settings</strong>: Include real-time system information in deployments</p> <h3 id=example-configurations>Example Configurations</h3> <h4 id=yaml-configuration>YAML Configuration</h4> <pre><code class=language-yaml>targets:
  - name: production
    host: prod.example.com
    user: deploy
    private_key: ~/.ssh/id_rsa

jobs:
  - name: deploy-app
    steps:
      - run: echo &quot;Deploying application...&quot;
      - copy:
          local: ./app/
          remote: /var/www/app/
      - docker:
          image: myapp:latest
          name: myapp-container
          ports: [&quot;8080:80&quot;]
</code></pre> <h4 id=json-configuration>JSON Configuration</h4> <pre><code class=language-json>{
  &quot;targets&quot;: [
    {
      &quot;name&quot;: &quot;production&quot;,
      &quot;host&quot;: &quot;prod.example.com&quot;,
      &quot;user&quot;: &quot;deploy&quot;,
      &quot;private_key&quot;: &quot;~/.ssh/id_rsa&quot;
    }
  ],
  &quot;jobs&quot;: [
    {
      &quot;name&quot;: &quot;deploy-app&quot;,
      &quot;steps&quot;: [
        {
          &quot;run&quot;: &quot;echo \&quot;Deploying application...\&quot;&quot;
        },
        {
          &quot;copy&quot;: {
            &quot;local&quot;: &quot;./app/&quot;,
            &quot;remote&quot;: &quot;/var/www/app/&quot;
          }
        },
        {
          &quot;docker&quot;: {
            &quot;image&quot;: &quot;myapp:latest&quot;,
            &quot;name&quot;: &quot;myapp-container&quot;,
            &quot;ports&quot;: [&quot;8080:80&quot;],
            &quot;build&quot;: {
              &quot;context&quot;: &quot;./app&quot;,
              &quot;args&quot;: {
                &quot;VERSION&quot;: &quot;1.0.0&quot;
              }
            }
          }
        }
      ]
    }
  ]
}
</code></pre> <h4 id=typescript-configuration>TypeScript Configuration</h4> <pre><code class=language-ts>export default {
  targets: [
    { name: &quot;production&quot;, host: &quot;prod.example.com&quot;, user: &quot;deploy&quot;, private_key: &quot;~/.ssh/id_rsa&quot; }
  ],
  jobs: [
    {
      name: &quot;deploy-app&quot;,
      steps: [
        { run: &quot;echo \&quot;Deploying application...\&quot;&quot; },
        { copy: { local: &quot;./app/&quot;, remote: &quot;/var/www/app/&quot; } },
        { docker: { image: &quot;myapp:latest&quot;, name: &quot;myapp-container&quot;, ports: [&quot;8080:80&quot;] } }
      ]
    }
  ]
};
</code></pre> <h4 id=typescript-with-dynamic-configuration>TypeScript with Dynamic Configuration</h4> <pre><code class=language-ts>// Example of dynamic configuration with TypeScript
import * as fs from 'fs';

// Load environments from external file
const environments = JSON.parse(fs.readFileSync('./environments.json', 'utf8'));

// Create reusable step patterns
const createDeploymentSteps = (appName: string, version: string) =&gt; [
  { run: `echo &quot;Deploying ${appName} version ${version}...&quot;` },
  { copy: { local: `./${appName}/`, remote: `/var/www/${appName}/` } },
  { docker: { 
      image: `${appName}:${version}`, 
      name: `${appName}-container`,
      ports: [&quot;8080:80&quot;] 
    }
  }
];

export default {
  targets: environments.map(env =&gt; ({
    name: env.name,
    host: env.host,
    user: env.user,
    private_key: env.keyPath
  })),
  jobs: [
    {
      name: &quot;deploy-frontend&quot;,
      steps: createDeploymentSteps(&quot;frontend&quot;, &quot;1.2.3&quot;)
    },
    {
      name: &quot;deploy-backend&quot;,
      steps: createDeploymentSteps(&quot;backend&quot;, &quot;4.5.6&quot;)
    }
  ]
};
</code></pre> <h4 id=golang-configuration>Golang Configuration</h4> <pre><code class=language-go>package main

import (
    &quot;github.com/nickalie/nship/pkg/nship&quot;
    &quot;log&quot;
)

func main() {
    err := nship.NewBuilder().
        AddTarget(&amp;nship.Target{
            Host: &quot;prod.example.com&quot;,
            User: &quot;deploy&quot;,
            PrivateKey: &quot;~/.ssh/id_rsa&quot;,
        }).
        AddJob(&quot;deploy-app&quot;).
        AddRunStep(&quot;echo 'Deploying application...'&quot;).
        AddCopyStep(&quot;./app/&quot;, &quot;/var/www/app/&quot;).
        AddDockerStep(&amp;nship.DockerStep{
            Image:    &quot;myapp:latest&quot;,
            Name:     &quot;myapp-container&quot;,
            Ports:    []string{&quot;8080:80&quot;},
        }).
        Print()

    if err != nil {
        log.Fatal(err)
    }
}
</code></pre> <h4 id=example-configuration-toml>Example Configuration (TOML)</h4> <pre><code class=language-toml>[[targets]]
name = &quot;production&quot;
host = &quot;prod.example.com&quot;
user = &quot;deploy&quot;
private_key = &quot;~/.ssh/id_rsa&quot;

[[jobs]]
name = &quot;deploy-app&quot;

[[jobs.steps]]
run = &quot;echo 'Deploying application...'&quot;

[[jobs.steps.copy]]
local = &quot;./app/&quot;
remote = &quot;/var/www/app/&quot;

[[jobs.steps.docker]]
image = &quot;myapp:latest&quot;
name = &quot;myapp-container&quot;
ports = [&quot;8080:80&quot;]
</code></pre> <h2 id=deployment-steps>Deployment Steps</h2> <h3 id=run-step>Run Step</h3> <p>Executes a shell command:</p> <pre><code class=language-yaml>- run: |
    echo &quot;Starting deployment...&quot;
    mkdir -p /var/www/app
    cp -r ./app/* /var/www/app/
    systemctl restart myapp

- run: systemctl restart myapp
</code></pre> <h3 id=copy-step>Copy Step</h3> <p>Copies files to a remote target. Identical files are not copied to optimize performance:</p> <pre><code class=language-yaml>- copy:
    local: ./config/
    remote: /etc/myapp/
</code></pre> <h3 id=docker-step>Docker Step</h3> <p>Runs a Docker container on the target. If the container already exists, it will be removed before starting a new instance:</p> <pre><code class=language-yaml>- docker:
    image: nginx:latest
    name: web-server
    ports: [&quot;80:80&quot;]
    environment:
      - &quot;ENV_VAR=value&quot;
    volumes:
      - &quot;/host/path:/container/path&quot;
    labels:
      app: &quot;my-web-app&quot;
    networks:
      - &quot;custom-network&quot;
    restart: &quot;always&quot;
    command:
      - &quot;npm start&quot;
    build:
      context: ./path/to/directory/with/dockerfile
      args:
        VERSION: &quot;1.0.0&quot;
        DEBUG: &quot;true&quot;
</code></pre> <h4 id=supported-keys-in-docker-step>Supported Keys in Docker Step</h4> <ul> <li><code>image</code> (string, required): Docker image to use.</li> <li><code>name</code> (string, required): Name of the Docker container.</li> <li><code>ports</code> (list of strings, optional): List of port mappings in the format <code>host:container</code>.</li> <li><code>environment</code> (list of strings, optional): List of environment variables.</li> <li><code>volumes</code> (list of strings, optional): List of volume mounts in the format <code>host_path:container_path</code>.</li> <li><code>labels</code> (map of key-value pairs, optional): Labels to assign to the container.</li> <li><code>networks</code> (list of strings, optional): List of network names to connect the container.</li> <li><code>restart</code> (string, optional): Restart policy (<code>no</code>, <code>on-failure</code>, <code>always</code>, <code>unless-stopped</code>).</li> <li><code>command</code> (list of strings, optional): List of commands to run inside the container.</li> <li><code>build</code> (object, optional): Configuration for building the Docker image before running the container.</li> <li><code>context</code> (string, required): Build context path where the Dockerfile is located.</li> <li><code>args</code> (map of key-value pairs, optional): Build arguments to pass to the Docker build command.</li> </ul> <h2 id=ansible-vault-support>Ansible Vault Support</h2> <p>nship supports Ansible Vault for secure credentials management. To decrypt a vault file, use:</p> <pre><code class=language-sh>nship --env-file=env.vault --vault-password=yourpassword
</code></pre> <p>The VAULT_PASSWORD environment variable can also be used to provide the password for decrypting Ansible Vault files, allowing for more secure automation workflows.</p> <p>If both --vault-password and the VAULT_PASSWORD environment variable are missing, the tool will prompt for the password in the terminal.</p> <h2 id=skipping-unchanged-steps>Skipping Unchanged Steps</h2> <p>By default, nship skips execution of unchanged steps to optimize performance. Use <code>--no-skip</code> to disable this behavior.</p> <h2 id=contributing>Contributing</h2> <p>Contributions are welcome! Feel free to submit issues and pull requests.</p> <h2 id=license>License</h2> <p>This project is licensed under the MIT License.</p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": ".", "features": ["navigation.instant", "toc.follow", "toc.integrate", "content.code.annotate", "navigation.sections"], "search": "assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script> <script src=assets/javascripts/bundle.c8b220af.min.js></script> </body> </html>